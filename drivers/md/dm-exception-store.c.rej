--- drivers/md/dm-exception-store.c
+++ drivers/md/dm-exception-store.c
@@ -216,7 +216,8 @@
 		type = get_type("N");
 	else {
 		ti->error = "Persistent flag is not P or N";
-		return -EINVAL;
+		r = -EINVAL;
+		goto bad_type;
 	}
 
 	if (!type) {
