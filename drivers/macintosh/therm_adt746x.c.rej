--- drivers/macintosh/therm_adt746x.c
+++ drivers/macintosh/therm_adt746x.c
@@ -89,8 +88,6 @@
 
 static void write_both_fan_speed(struct thermostat *th, int speed);
 static void write_fan_speed(struct thermostat *th, int speed, int fan);
-static void thermostat_create_files(void);
-static void thermostat_remove_files(void);
 
 static int
 write_reg(struct thermostat* th, int reg, u8 data)
@@ -162,8 +159,6 @@
 	struct thermostat *th = i2c_get_clientdata(client);
 	int i;
 	
-	thermostat_remove_files();
-
 	if (thread_therm != NULL) {
 		kthread_stop(thread_therm);
 	}
@@ -444,8 +431,6 @@
 		return -ENOMEM;
 	}
 
-	thermostat_create_files();
-
 	return 0;
 }
 
@@ -563,6 +548,7 @@
 	struct device_node* np;
 	const u32 *prop;
 	int i = 0, offset = 0;
+	int err;
 
 	np = of_find_node_by_name(NULL, "fan");
 	if (!np)
@@ -629,17 +615,6 @@
 		return -ENODEV;
 	}
 
-#ifndef CONFIG_I2C_POWERMAC
-	request_module("i2c-powermac");
-#endif
-
-	return i2c_add_driver(&thermostat_driver);
-}
-
-static void thermostat_create_files(void)
-{
-	int err;
-
 	err = device_create_file(&of_dev->dev, &dev_attr_sensor1_temperature);
 	err |= device_create_file(&of_dev->dev, &dev_attr_sensor2_temperature);
 	err |= device_create_file(&of_dev->dev, &dev_attr_sensor1_limit);
@@ -654,9 +629,16 @@
 	if (err)
 		printk(KERN_WARNING
 			"Failed to create tempertaure attribute file(s).\n");
+
+#ifndef CONFIG_I2C_POWERMAC
+	request_module("i2c-powermac");
+#endif
+
+	return i2c_add_driver(&thermostat_driver);
 }
 
-static void thermostat_remove_files(void)
+static void __exit
+thermostat_exit(void)
 {
 	if (of_dev) {
 		device_remove_file(&of_dev->dev, &dev_attr_sensor1_temperature);
@@ -673,14 +655,9 @@
 			device_remove_file(&of_dev->dev,
 					   &dev_attr_sensor2_fan_speed);
 
+		of_device_unregister(of_dev);
 	}
-}
-
-static void __exit
-thermostat_exit(void)
-{
 	i2c_del_driver(&thermostat_driver);
-	of_device_unregister(of_dev);
 }
 
 module_init(thermostat_init);
